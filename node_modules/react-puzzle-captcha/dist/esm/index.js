import e,{memo as t,useState as n,useRef as r,useEffect as c}from"react";function i(e,t){return Math.round(Math.random()*(t-e)+e)}function a(e,t){return e+t}function o(e){return e*e}var l=t((function(t){var l=t.width,u=void 0===l?320:l,s=t.height,d=void 0===s?160:s,f=t.l,v=void 0===f?42:f,m=t.r,h=void 0===m?9:m,p=t.imgUrl,g=t.text,y=t.refreshIcon,w=void 0===y?"https://raw.githubusercontent.com/venkatmcajj/react-puzzle-captcha/master/docs/icon12.png":y,C=t.visible,x=void 0===C||C,E=t.onDraw,T=t.onCustomverify,M=t.onSuccess,I=t.onFail,b=t.onRefresh,N=n(!1),S=N[0],X=N[1],k=n(0),D=k[0],R=k[1],A=n("sliderContainer"),Y=A[0],_=A[1],L=n(g),O=L[0],P=L[1],U=r(null),j=r(null),q=r(null),z=r(!1),F=r([]),W=r(0),G=r(0),H=r(0),V=r(0),B=Math.PI,J=v+2*h+3,K=function(e,t,n,r){e.beginPath(),e.moveTo(t,n),e.arc(t+v/2,n-h+2,h,.72*B,2.26*B),e.lineTo(t+v,n),e.arc(t+v+h-2,n+v/2,h,1.21*B,2.78*B),e.lineTo(t+v,n+v),e.lineTo(t,n+v),e.arc(t+h-2,n+v/2,h+.4,2.76*B,1.24*B,!0),e.lineTo(t,n),e.lineWidth=2,e.fillStyle="rgba(255, 255, 255, 0.7)",e.strokeStyle="rgba(255, 255, 255, 0.7)",e.stroke(),e.globalCompositeOperation="destination-over","fill"===r?e.fill():e.clip()},Q=function(){return p||"https://picsum.photos/id/".concat(i(0,1084),"/").concat(u,"/").concat(d)},Z=function(){var e=function(e){var t=new Image;return t.crossOrigin="Anonymous",t.onload=e,t.onerror=function(){t.setSrc(Q())},t.setSrc=function(e){if(window.navigator.userAgent.indexOf("Trident")>-1){var n=new XMLHttpRequest;n.onloadend=function(e){var n=new FileReader;n.readAsDataURL(e.target.response),n.onloadend=function(e){var n;t.src=null===(n=null==e?void 0:e.target)||void 0===n?void 0:n.result}},n.open("GET",e),n.responseType="blob",n.send()}else t.src=e},t.setSrc(Q()),t}((function(){X(!1),function(e){var t=U.current.getContext("2d"),n=j.current.getContext("2d");H.current=i(J+10,u-(J+10)),V.current=i(10+2*h,d-(J+10)),K(t,H.current,V.current,"fill"),K(n,H.current,V.current,"clip"),t.drawImage(e,0,0,u,d),n.drawImage(e,0,0,u,d);var r=V.current-2*h-1,c=n.getImageData(H.current-3,r,J,J);j.current.width=J,n.putImageData(c,0,r)}(e)}));q.current=e},$=function(){var e=U.current.getContext("2d"),t=j.current.getContext("2d");R(0),_("sliderContainer"),j.current.width=u,j.current.style.left="0px",e.clearRect(0,0,u,d),t.clearRect(0,0,u,d),X(!0),q.current.setSrc(Q())},ee=function(){var e=F.current,t=e.reduce(a)/e.length,n=e.map((function(e){return e-t})),r=Math.sqrt(n.map(o).reduce(a)/e.length),c=parseInt(j.current.style.left);return{spliced:Math.abs(c-H.current)<10,verified:0!==r,left:c,destX:H.current}},te=function(e){W.current=e.clientX||e.touches[0].clientX,G.current=e.clientY||e.touches[0].clientY,z.current=!0},ne=function(e){if(!z.current)return!1;e.preventDefault();var t=e.clientX||e.touches[0].clientX,n=e.clientY||e.touches[0].clientY,r=t-W.current,c=n-G.current;if(r<0||r+38>=u)return!1;R(r);var i=(u-40-20)/(u-40)*r;return j.current.style.left=i+"px",_("sliderContainer sliderContainer_active"),F.current.push(c),E&&E(i),!0},re=function(e){if(!z.current)return!1;if(z.current=!1,(e.clientX||e.changedTouches[0].clientX)===W.current)return!1;_("sliderContainer");var t=T?T(ee()):ee(),n=t.spliced,r=t.verified;return n?r?(_("sliderContainer sliderContainer_success"),"function"==typeof M&&M()):(_("sliderContainer sliderContainer_fail"),P("Please try again"),$()):(_("sliderContainer sliderContainer_fail"),"function"==typeof I&&I(),setTimeout((function(){$()}),1e3)),!0};return c((function(){x&&(q.current?$():Z())}),[x]),e.createElement("div",{className:"verifyWrap",style:{width:u+"px",margin:"0 auto",display:x?"":"none"},onMouseMove:ne,onMouseUp:re,onTouchMove:ne,onTouchEnd:re},e.createElement("div",{className:"canvasArea"},e.createElement("canvas",{ref:U,width:u,height:d}),e.createElement("canvas",{ref:j,className:"block",width:u,height:d,onMouseDown:te,onTouchStart:te})),e.createElement("div",{className:Y,style:{pointerEvents:S?"none":"auto",width:u+"px"}},e.createElement("div",{className:"sliderMask",style:{width:D+"px"}},e.createElement("div",{className:"slider",style:{left:D+"px"},onMouseDown:te,onTouchStart:te},e.createElement("div",{className:"sliderIcon"},"â†’"))),e.createElement("div",{className:"sliderText"},O)),e.createElement("div",{className:"refreshIcon",onClick:function(){$(),"function"==typeof b&&b()},style:{backgroundImage:"url(".concat(w,")")}}),e.createElement("div",{className:"loadingContainer",style:{width:u+"px",height:d+"px",display:S?"":"none"}},e.createElement("div",{className:"loadingIcon"}),e.createElement("span",null,"Loading...")))}));export{l as Verify};
//# sourceMappingURL=index.js.map
