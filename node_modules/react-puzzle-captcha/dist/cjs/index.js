"use strict";var e=require("react");function t(e,t){return Math.round(Math.random()*(t-e)+e)}function n(e,t){return e+t}function r(e){return e*e}var c=e.memo((function(c){var i=c.width,a=void 0===i?320:i,o=c.height,u=void 0===o?160:o,s=c.l,l=void 0===s?42:s,d=c.r,f=void 0===d?9:d,v=c.imgUrl,m=c.text,h=c.refreshIcon,p=void 0===h?"https://raw.githubusercontent.com/venkatmcajj/react-puzzle-captcha/master/docs/icon12.png":h,g=c.visible,y=void 0===g||g,w=c.onDraw,C=c.onCustomverify,E=c.onSuccess,x=c.onFail,R=c.onRefresh,T=e.useState(!1),M=T[0],S=T[1],I=e.useState(0),b=I[0],N=I[1],X=e.useState("sliderContainer"),k=X[0],D=X[1],A=e.useState(m),Y=A[0],_=A[1],q=e.useRef(null),L=e.useRef(null),O=e.useRef(null),P=e.useRef(!1),U=e.useRef([]),j=e.useRef(0),z=e.useRef(0),F=e.useRef(0),W=e.useRef(0),G=Math.PI,H=l+2*f+3,V=function(e,t,n,r){e.beginPath(),e.moveTo(t,n),e.arc(t+l/2,n-f+2,f,.72*G,2.26*G),e.lineTo(t+l,n),e.arc(t+l+f-2,n+l/2,f,1.21*G,2.78*G),e.lineTo(t+l,n+l),e.lineTo(t,n+l),e.arc(t+f-2,n+l/2,f+.4,2.76*G,1.24*G,!0),e.lineTo(t,n),e.lineWidth=2,e.fillStyle="rgba(255, 255, 255, 0.7)",e.strokeStyle="rgba(255, 255, 255, 0.7)",e.stroke(),e.globalCompositeOperation="destination-over","fill"===r?e.fill():e.clip()},B=function(){return v||"https://picsum.photos/id/".concat(t(0,1084),"/").concat(a,"/").concat(u)},J=function(){var e=function(e){var t=new Image;return t.crossOrigin="Anonymous",t.onload=e,t.onerror=function(){t.setSrc(B())},t.setSrc=function(e){if(window.navigator.userAgent.indexOf("Trident")>-1){var n=new XMLHttpRequest;n.onloadend=function(e){var n=new FileReader;n.readAsDataURL(e.target.response),n.onloadend=function(e){var n;t.src=null===(n=null==e?void 0:e.target)||void 0===n?void 0:n.result}},n.open("GET",e),n.responseType="blob",n.send()}else t.src=e},t.setSrc(B()),t}((function(){S(!1),function(e){var n=q.current.getContext("2d"),r=L.current.getContext("2d");F.current=t(H+10,a-(H+10)),W.current=t(10+2*f,u-(H+10)),V(n,F.current,W.current,"fill"),V(r,F.current,W.current,"clip"),n.drawImage(e,0,0,a,u),r.drawImage(e,0,0,a,u);var c=W.current-2*f-1,i=r.getImageData(F.current-3,c,H,H);L.current.width=H,r.putImageData(i,0,c)}(e)}));O.current=e},K=function(){var e=q.current.getContext("2d"),t=L.current.getContext("2d");N(0),D("sliderContainer"),L.current.width=a,L.current.style.left="0px",e.clearRect(0,0,a,u),t.clearRect(0,0,a,u),S(!0),O.current.setSrc(B())},Q=function(){var e=U.current,t=e.reduce(n)/e.length,c=e.map((function(e){return e-t})),i=Math.sqrt(c.map(r).reduce(n)/e.length),a=parseInt(L.current.style.left);return{spliced:Math.abs(a-F.current)<10,verified:0!==i,left:a,destX:F.current}},Z=function(e){j.current=e.clientX||e.touches[0].clientX,z.current=e.clientY||e.touches[0].clientY,P.current=!0},$=function(e){if(!P.current)return!1;e.preventDefault();var t=e.clientX||e.touches[0].clientX,n=e.clientY||e.touches[0].clientY,r=t-j.current,c=n-z.current;if(r<0||r+38>=a)return!1;N(r);var i=(a-40-20)/(a-40)*r;return L.current.style.left=i+"px",D("sliderContainer sliderContainer_active"),U.current.push(c),w&&w(i),!0},ee=function(e){if(!P.current)return!1;if(P.current=!1,(e.clientX||e.changedTouches[0].clientX)===j.current)return!1;D("sliderContainer");var t=C?C(Q()):Q(),n=t.spliced,r=t.verified;return n?r?(D("sliderContainer sliderContainer_success"),"function"==typeof E&&E()):(D("sliderContainer sliderContainer_fail"),_("Please try again"),K()):(D("sliderContainer sliderContainer_fail"),"function"==typeof x&&x(),setTimeout((function(){K()}),1e3)),!0};return e.useEffect((function(){y&&(O.current?K():J())}),[y]),e.createElement("div",{className:"verifyWrap",style:{width:a+"px",margin:"0 auto",display:y?"":"none"},onMouseMove:$,onMouseUp:ee,onTouchMove:$,onTouchEnd:ee},e.createElement("div",{className:"canvasArea"},e.createElement("canvas",{ref:q,width:a,height:u}),e.createElement("canvas",{ref:L,className:"block",width:a,height:u,onMouseDown:Z,onTouchStart:Z})),e.createElement("div",{className:k,style:{pointerEvents:M?"none":"auto",width:a+"px"}},e.createElement("div",{className:"sliderMask",style:{width:b+"px"}},e.createElement("div",{className:"slider",style:{left:b+"px"},onMouseDown:Z,onTouchStart:Z},e.createElement("div",{className:"sliderIcon"},"â†’"))),e.createElement("div",{className:"sliderText"},Y)),e.createElement("div",{className:"refreshIcon",onClick:function(){K(),"function"==typeof R&&R()},style:{backgroundImage:"url(".concat(p,")")}}),e.createElement("div",{className:"loadingContainer",style:{width:a+"px",height:u+"px",display:M?"":"none"}},e.createElement("div",{className:"loadingIcon"}),e.createElement("span",null,"Loading...")))}));exports.Verify=c;
//# sourceMappingURL=index.js.map
