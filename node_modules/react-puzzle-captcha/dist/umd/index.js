!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).ReactPuzzleCaptcha={},e.React)}(this,(function(e,t){"use strict";function n(e,t){return Math.round(Math.random()*(t-e)+e)}function r(e,t){return e+t}function i(e){return e*e}var c=t.memo((function(e){var c=e.width,a=void 0===c?320:c,o=e.height,u=void 0===o?160:o,s=e.l,l=void 0===s?42:s,d=e.r,f=void 0===d?9:d,v=e.imgUrl,h=e.text,p=e.refreshIcon,m=void 0===p?"https://raw.githubusercontent.com/venkatmcajj/react-puzzle-captcha/master/docs/icon12.png":p,g=e.visible,y=void 0===g||g,w=e.onDraw,C=e.onCustomverify,x=e.onSuccess,E=e.onFail,R=e.onRefresh,T=t.useState(!1),b=T[0],M=T[1],S=t.useState(0),I=S[0],N=S[1],X=t.useState("sliderContainer"),k=X[0],D=X[1],z=t.useState(h),A=z[0],P=z[1],Y=t.useRef(null),_=t.useRef(null),j=t.useRef(null),q=t.useRef(!1),L=t.useRef([]),O=t.useRef(0),U=t.useRef(0),F=t.useRef(0),W=t.useRef(0),G=Math.PI,H=l+2*f+3,V=function(e,t,n,r){e.beginPath(),e.moveTo(t,n),e.arc(t+l/2,n-f+2,f,.72*G,2.26*G),e.lineTo(t+l,n),e.arc(t+l+f-2,n+l/2,f,1.21*G,2.78*G),e.lineTo(t+l,n+l),e.lineTo(t,n+l),e.arc(t+f-2,n+l/2,f+.4,2.76*G,1.24*G,!0),e.lineTo(t,n),e.lineWidth=2,e.fillStyle="rgba(255, 255, 255, 0.7)",e.strokeStyle="rgba(255, 255, 255, 0.7)",e.stroke(),e.globalCompositeOperation="destination-over","fill"===r?e.fill():e.clip()},B=function(){return v||"https://picsum.photos/id/".concat(n(0,1084),"/").concat(a,"/").concat(u)},J=function(){var e=function(e){var t=new Image;return t.crossOrigin="Anonymous",t.onload=e,t.onerror=function(){t.setSrc(B())},t.setSrc=function(e){if(window.navigator.userAgent.indexOf("Trident")>-1){var n=new XMLHttpRequest;n.onloadend=function(e){var n=new FileReader;n.readAsDataURL(e.target.response),n.onloadend=function(e){var n;t.src=null===(n=null==e?void 0:e.target)||void 0===n?void 0:n.result}},n.open("GET",e),n.responseType="blob",n.send()}else t.src=e},t.setSrc(B()),t}((function(){M(!1),function(e){var t=Y.current.getContext("2d"),r=_.current.getContext("2d");F.current=n(H+10,a-(H+10)),W.current=n(10+2*f,u-(H+10)),V(t,F.current,W.current,"fill"),V(r,F.current,W.current,"clip"),t.drawImage(e,0,0,a,u),r.drawImage(e,0,0,a,u);var i=W.current-2*f-1,c=r.getImageData(F.current-3,i,H,H);_.current.width=H,r.putImageData(c,0,i)}(e)}));j.current=e},K=function(){var e=Y.current.getContext("2d"),t=_.current.getContext("2d");N(0),D("sliderContainer"),_.current.width=a,_.current.style.left="0px",e.clearRect(0,0,a,u),t.clearRect(0,0,a,u),M(!0),j.current.setSrc(B())},Q=function(){var e=L.current,t=e.reduce(r)/e.length,n=e.map((function(e){return e-t})),c=Math.sqrt(n.map(i).reduce(r)/e.length),a=parseInt(_.current.style.left);return{spliced:Math.abs(a-F.current)<10,verified:0!==c,left:a,destX:F.current}},Z=function(e){O.current=e.clientX||e.touches[0].clientX,U.current=e.clientY||e.touches[0].clientY,q.current=!0},$=function(e){if(!q.current)return!1;e.preventDefault();var t=e.clientX||e.touches[0].clientX,n=e.clientY||e.touches[0].clientY,r=t-O.current,i=n-U.current;if(r<0||r+38>=a)return!1;N(r);var c=(a-40-20)/(a-40)*r;return _.current.style.left=c+"px",D("sliderContainer sliderContainer_active"),L.current.push(i),w&&w(c),!0},ee=function(e){if(!q.current)return!1;if(q.current=!1,(e.clientX||e.changedTouches[0].clientX)===O.current)return!1;D("sliderContainer");var t=C?C(Q()):Q(),n=t.spliced,r=t.verified;return n?r?(D("sliderContainer sliderContainer_success"),"function"==typeof x&&x()):(D("sliderContainer sliderContainer_fail"),P("Please try again"),K()):(D("sliderContainer sliderContainer_fail"),"function"==typeof E&&E(),setTimeout((function(){K()}),1e3)),!0};return t.useEffect((function(){y&&(j.current?K():J())}),[y]),t.createElement("div",{className:"verifyWrap",style:{width:a+"px",margin:"0 auto",display:y?"":"none"},onMouseMove:$,onMouseUp:ee,onTouchMove:$,onTouchEnd:ee},t.createElement("div",{className:"canvasArea"},t.createElement("canvas",{ref:Y,width:a,height:u}),t.createElement("canvas",{ref:_,className:"block",width:a,height:u,onMouseDown:Z,onTouchStart:Z})),t.createElement("div",{className:k,style:{pointerEvents:b?"none":"auto",width:a+"px"}},t.createElement("div",{className:"sliderMask",style:{width:I+"px"}},t.createElement("div",{className:"slider",style:{left:I+"px"},onMouseDown:Z,onTouchStart:Z},t.createElement("div",{className:"sliderIcon"},"â†’"))),t.createElement("div",{className:"sliderText"},A)),t.createElement("div",{className:"refreshIcon",onClick:function(){K(),"function"==typeof R&&R()},style:{backgroundImage:"url(".concat(m,")")}}),t.createElement("div",{className:"loadingContainer",style:{width:a+"px",height:u+"px",display:b?"":"none"}},t.createElement("div",{className:"loadingIcon"}),t.createElement("span",null,"Loading...")))}));e.Verify=c}));
//# sourceMappingURL=index.js.map
